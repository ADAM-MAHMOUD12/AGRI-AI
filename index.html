<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸŒ± Ù…Ù†ØµØ© Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ© - Agri AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: {
            water: '#38bdf8',
            fertilizer: '#22c55e',
            yield: '#facc15',
            cost: '#f87171',
            analysis: '#6366f1'
          }
        }
      }
    }
  </script>
  <style>
    .fade-in { animation: fadeIn 0.6s ease-in-out; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="bg-gray-50 font-sans p-4 sm:p-8">

  <div class="max-w-6xl mx-auto">
    <header class="text-center mb-10 bg-white p-8 rounded-3xl shadow-xl border-t-8 border-green-600">
      <h1 class="text-4xl sm:text-5xl font-extrabold text-green-700 mb-3">ğŸŒ¿ Ù…Ù†ØµØ© Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø°ÙƒÙŠØ© - Agri AI</h1>
      <p class="text-gray-600 text-lg">ØªØ­Ù„ÙŠÙ„ Ù…ØªÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„ØªØ­Ø³ÙŠÙ† ÙƒÙØ§Ø¡Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©</p>
    </header>

    <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
    <div class="bg-white p-6 sm:p-10 rounded-3xl shadow-lg mb-10 border-l-4 border-green-600">
      <form id="farm-form" class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div>
          <label class="block font-semibold mb-2">ğŸŒ¾ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØµÙˆÙ„</label>
          <input id="crop_type" value="Ø·Ù…Ø§Ø·Ù…" class="w-full border rounded-xl p-3" />
        </div>
        <div>
          <label class="block font-semibold mb-2">ğŸ’§ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Â³/Ø£Ø³Ø¨ÙˆØ¹)</label>
          <input id="current_water" type="number" value="150" class="w-full border rounded-xl p-3" />
        </div>
        <div>
          <label class="block font-semibold mb-2">ğŸ§ª Ù†ÙˆØ¹ Ø§Ù„Ø³Ù…Ø§Ø¯</label>
          <input id="current_fertilizer" value="NPK 20-20-20" class="w-full border rounded-xl p-3" />
        </div>
        <div>
          <label class="block font-semibold mb-2">ğŸŒ Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø¨Ø©</label>
          <select id="soil_type" class="w-full border rounded-xl p-3">
            <option>Ø·ÙŠÙ†ÙŠØ©</option><option>Ø±Ù…Ù„ÙŠØ©</option><option>Ø·Ù…ÙŠÙŠØ©</option><option>Ø¬ÙŠØ±ÙŠØ©</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <button id="analyze-btn" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl hover:bg-green-700 transition-all text-lg">
            ğŸš€ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
          </button>
        </div>
      </form>
    </div>

    <!-- Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading" class="hidden text-center text-xl font-semibold text-green-600 animate-pulse">
      â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø²Ø±Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...
    </div>

    <!-- Ø§Ù„Ù†ØªØ§Ø¦Ø¬ -->
    <section id="results" class="hidden bg-white p-6 sm:p-10 rounded-3xl shadow-2xl fade-in border-l-4 border-green-600">
      <h2 class="text-3xl font-extrabold text-green-700 mb-8 text-center">ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒÙŠØ©</h2>
      <div id="section-water" class="mb-8 hidden">
        <h3 class="text-2xl font-bold text-water mb-4">ğŸ’§ ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙŠØ§Ù‡</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="cards-water"></div>
      </div>
      <div id="section-fertilizer" class="mb-8 hidden">
        <h3 class="text-2xl font-bold text-fertilizer mb-4">ğŸŒ¿ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ù…Ø¯Ø©</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="cards-fertilizer"></div>
      </div>
      <div id="section-yield" class="mb-8 hidden">
        <h3 class="text-2xl font-bold text-yellow-500 mb-4">ğŸŒ¾ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø­ØµÙˆÙ„</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="cards-yield"></div>
      </div>
      <div id="section-cost" class="mb-8 hidden">
        <h3 class="text-2xl font-bold text-cost mb-4">ğŸ’° ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙƒÙ„ÙØ©</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="cards-cost"></div>
      </div>
      <div id="section-analysis" class="mb-8 hidden">
        <h3 class="text-2xl font-bold text-analysis mb-4">ğŸ“‹ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="cards-analysis"></div>
      </div>
    </section>

    <footer class="text-center mt-12 text-gray-500 text-sm">
      ğŸŒ± <span class="font-bold text-green-700">Agri AI</span> Â© 2025 - Ù…Ø¹Ù‹Ø§ Ù†Ø­Ùˆ Ø²Ø±Ø§Ø¹Ø© Ø£ÙƒØ«Ø± Ø°ÙƒØ§Ø¡Ù‹
    </footer>
  </div>

  <script>
    const apiUrl = "https://agri-ai.adammaan41.workers.dev";

    const categories = {
      water: { keywords: ["Ù…Ø§Ø¡", "Ø±ÙŠ", "Ø±Ø·ÙˆØ¨Ø©"], color: "border-water", section: "cards-water" },
      fertilizer: { keywords: ["Ø³Ù…Ø§Ø¯", "Ø£Ø³Ù…Ø¯Ø©", "ØªØºØ°ÙŠØ©"], color: "border-fertilizer", section: "cards-fertilizer" },
      yield: { keywords: ["Ù…Ø­ØµÙˆÙ„", "Ø¥Ù†ØªØ§Ø¬", "Ø­ØµØ§Ø¯"], color: "border-yellow-400", section: "cards-yield" },
      cost: { keywords: ["ØªÙƒÙ„ÙØ©", "Ù†ÙÙ‚Ø§Øª", "ØªÙˆÙÙŠØ±"], color: "border-cost", section: "cards-cost" },
      analysis: { keywords: [], color: "border-analysis", section: "cards-analysis" }
    };

    document.getElementById("farm-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      document.getElementById("results").classList.add("hidden");
      document.getElementById("loading").classList.remove("hidden");

      const payload = {
        crop_type: crop_type.value,
        soil_type: soil_type.value,
        current_water: current_water.value,
        current_fertilizer: current_fertilizer.value
      };

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        const text = data.message || data.result || "Ù„Ù… ÙŠØªÙ… ØªÙ„Ù‚ÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù….";

        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø±Ø¯ Ø¥Ù„Ù‰ ÙÙ‚Ø±Ø§Øª
        const lines = text.split(/[\n\.]+/).filter(x => x.trim());

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        Object.keys(categories).forEach(k => {
          document.getElementById("section-" + k).classList.add("hidden");
          document.getElementById(categories[k].section).innerHTML = "";
        });

        lines.forEach(line => {
          let matched = false;
          for (const [key, cfg] of Object.entries(categories)) {
            if (cfg.keywords.some(word => line.includes(word))) {
              addCard(cfg.section, line, cfg.color);
              document.getElementById("section-" + key).classList.remove("hidden");
              matched = true;
              break;
            }
          }
          if (!matched) {
            addCard(categories.analysis.section, line, categories.analysis.color);
            document.getElementById("section-analysis").classList.remove("hidden");
          }
        });

      } catch (err) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„: " + err.message);
      } finally {
        document.getElementById("loading").classList.add("hidden");
        document.getElementById("results").classList.remove("hidden");
        document.getElementById("results").scrollIntoView({ behavior: "smooth" });
      }
    });

    function addCard(sectionId, text, borderColor) {
      const percentMatch = text.match(/(\d{1,3}) ?%/);
      const percent = percentMatch ? percentMatch[1] + "%" : "";
      const html = `
        <div class="p-5 bg-gray-50 border-l-4 ${borderColor} rounded-2xl shadow-md hover:shadow-lg transition-all fade-in">
          ${percent ? `<div class="text-4xl font-extrabold text-green-700 mb-2">${percent}</div>` : ""}
          <p class="text-gray-700 leading-relaxed">${text}</p>
        </div>`;
      document.getElementById(sectionId).insertAdjacentHTML("beforeend", html);
    }
  </script>

</body>
</html>
